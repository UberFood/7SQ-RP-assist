(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict';

var _wsClient = require('./ws-client');

var _wsClient2 = _interopRequireDefault(_wsClient);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var $ = window.jQuery;

var SERVER_ADDRESS = location.origin.replace(/^http/, 'ws');
var my_name = JSON.parse(sessionStorage.getItem('username'));

var ADD_CHARACTER_BUTTON_SELECTOR = '[data-name="add_character_button"]';
var FIGHTERS_DISPLAY_SELECTOR = '[data-name="fighters_display"]';
var CHARACTER_DISPLAY_SELECTOR = '[data-name="character_display"]';
var FIGHTERS_SELECT_SELECTOR = '[data-name="fighters_select"]';
var ADD_FIGHTER_BUTTON_SELECTOR = '[data-name="add_fighter_button"]';

var character_list = [];
var character_detailed_info = [];

function addCharacter() {
	var name_string = document.getElementById("name").value;
	var avatar = document.getElementById("avatar").value;
	avatar = '/images/' + avatar;
	var strength_string = document.getElementById("strength").value;
	var stamina_string = document.getElementById("stamina").value;
	var speed_string = document.getElementById("speed").value;
	var intelligence_string = document.getElementById("intelligence").value;

	var character = { name: name_string, avatar: avatar, strength: strength_string, stamina: stamina_string, speed: speed_string, intelligence: intelligence_string };

	var toSend = {};
	toSend.command = 'guild_sim_new_char';
	toSend.character = character;
	_wsClient2.default.sendMessage(toSend);
	document.location.reload();
}

function select_character(character_number) {
	clear_containers();
	var character = character_detailed_info[character_number];
	var name = character.name;
	var avatar = character.avatar;

	var name_display = document.createElement("h2");
	name_display.innerHTML = name;

	var avatar_container = document.createElement("div");
	var avatar_display = document.createElement("IMG");
	avatar_display.src = avatar;
	avatar_display.style.width = '250px';
	avatar_display.style.height = '250px';

	avatar_container.appendChild(avatar_display);

	var strength_display = document.createElement("h2");
	strength_display.innerHTML = "Cила: " + character.strength;

	var stamina_display = document.createElement("h2");
	stamina_display.innerHTML = "Телосложение: " + character.stamina;

	var speed_display = document.createElement("h2");
	speed_display.innerHTML = "Скорость: " + character.speed;

	var intelligence_display = document.createElement("h2");
	intelligence_display.innerHTML = "Интеллект: " + character.intelligence;

	character_info_container.append(name_display);
	character_info_container.append(avatar_container);
	character_info_container.append(strength_display);
	character_info_container.append(stamina_display);
	character_info_container.append(speed_display);
	character_info_container.append(intelligence_display);
}

function addFighterToTeam(team) {
	console.log(team);
}

function clear_containers() {
	character_info_container.html("");
}

_wsClient2.default.init(SERVER_ADDRESS);

_wsClient2.default.registerOpenHandler(function () {
	var toSend = {};
	toSend.command = 'guild_sim_init';
	_wsClient2.default.sendMessage(toSend);
});

_wsClient2.default.registerMessageHandler(function (data) {
	console.log(data);
	character_list = data.character_list;
	character_detailed_info = data.character_detailed_info;

	var _loop = function _loop(i) {
		character = character_detailed_info[i];
		query_string = '<img> id="fighter_image_' + i + '"';
		img = $(query_string);

		img.attr('src', character.avatar);
		img.attr('height', '100px');
		img.attr('width', '100px');
		img.click(function () {
			select_character(i);
		});
		img.appendTo(fighters_display_container);

		option = $("<option>");

		option.html(character.name);
		option.attr("value", i);
		fighters_select.append(option);
	};

	for (var i = 0; i < character_list.length; i++) {
		var character;
		var query_string;
		var img;
		var option;

		_loop(i);
	}
});

var add_character_button = $(ADD_CHARACTER_BUTTON_SELECTOR);
add_character_button.on('click', addCharacter);

var add_fighter_button = $(ADD_FIGHTER_BUTTON_SELECTOR);
add_fighter_button.on('click', function (event) {
	addFighterToTeam(event.target.getAttribute('team'));
});

var fighters_display_container = $(FIGHTERS_DISPLAY_SELECTOR);

var character_info_container = $(CHARACTER_DISPLAY_SELECTOR);

var fighters_select = $(FIGHTERS_SELECT_SELECTOR);

},{"./ws-client":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var socket = void 0;
var server_address = void 0;
var onMessageFunction = void 0;

function init(url) {
  server_address = url;
  socket = new WebSocket(url);
  console.log('connecting..');
}

function isReady() {
  return socket.readyState === WebSocket.OPEN;
}

function registerOpenHandler(handlerFunction) {
  socket.onopen = function () {
    console.log('open');
    handlerFunction();
  };
}

function registerMessageHandler(handlerFunction) {
  onMessageFunction = handlerFunction;
  socket.onmessage = function (e) {
    var data = JSON.parse(e.data);
    handlerFunction(data);
  };
}

function registerMessageHandlerDefault() {
  socket.onmessage = function (e) {
    var data = JSON.parse(e.data);
    onMessageFunction(data);
  };
}

function sendMessage(payload) {
  if (socket.readyState === WebSocket.OPEN) {
    socket.send(JSON.stringify(payload));
  } else {
    init(server_address);
    registerMessageHandler(onMessageFunction);
    if (socket.readyState === WebSocket.OPEN) {
      socket.send(JSON.stringify(payload));
    } else {
      console.log('Not send, but reconnected');
    }
  }
}

exports.default = {
  init: init,
  registerOpenHandler: registerOpenHandler,
  registerMessageHandler: registerMessageHandler,
  sendMessage: sendMessage,
  registerMessageHandlerDefault: registerMessageHandlerDefault,
  isReady: isReady
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAvc2NyaXB0cy9zcmMvZ3VpbGRfc2ltLmpzIiwiYXBwL3NjcmlwdHMvc3JjL3dzLWNsaWVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7Ozs7OztBQUVBLElBQUksSUFBSSxPQUFPLE1BQWY7O0FBRUEsSUFBSSxpQkFBaUIsU0FBUyxNQUFULENBQWdCLE9BQWhCLENBQXdCLE9BQXhCLEVBQWlDLElBQWpDLENBQXJCO0FBQ0EsSUFBSSxVQUFVLEtBQUssS0FBTCxDQUFXLGVBQWUsT0FBZixDQUF1QixVQUF2QixDQUFYLENBQWQ7O0FBRUEsSUFBSSxnQ0FBZ0Msb0NBQXBDO0FBQ0EsSUFBSSw0QkFBNEIsZ0NBQWhDO0FBQ0EsSUFBSSw2QkFBNkIsaUNBQWpDO0FBQ0EsSUFBSSwyQkFBMkIsK0JBQS9CO0FBQ0EsSUFBSSw4QkFBOEIsa0NBQWxDOztBQUVBLElBQUksaUJBQWlCLEVBQXJCO0FBQ0EsSUFBSSwwQkFBMEIsRUFBOUI7O0FBRUEsU0FBUyxZQUFULEdBQXdCO0FBQ3ZCLEtBQUksY0FBYyxTQUFTLGNBQVQsQ0FBd0IsTUFBeEIsRUFBZ0MsS0FBbEQ7QUFDQSxLQUFJLFNBQVMsU0FBUyxjQUFULENBQXdCLFFBQXhCLEVBQWtDLEtBQS9DO0FBQ0MsVUFBUyxhQUFhLE1BQXRCO0FBQ0QsS0FBSSxrQkFBa0IsU0FBUyxjQUFULENBQXdCLFVBQXhCLEVBQW9DLEtBQTFEO0FBQ0EsS0FBSSxpQkFBaUIsU0FBUyxjQUFULENBQXdCLFNBQXhCLEVBQW1DLEtBQXhEO0FBQ0EsS0FBSSxlQUFlLFNBQVMsY0FBVCxDQUF3QixPQUF4QixFQUFpQyxLQUFwRDtBQUNBLEtBQUksc0JBQXNCLFNBQVMsY0FBVCxDQUF3QixjQUF4QixFQUF3QyxLQUFsRTs7QUFFQSxLQUFJLFlBQVksRUFBRSxNQUFNLFdBQVIsRUFBcUIsUUFBUSxNQUE3QixFQUFxQyxVQUFVLGVBQS9DLEVBQWdFLFNBQVMsY0FBekUsRUFBeUYsT0FBTyxZQUFoRyxFQUE4RyxjQUFjLG1CQUE1SCxFQUFoQjs7QUFFQyxLQUFJLFNBQVMsRUFBYjtBQUNBLFFBQU8sT0FBUCxHQUFpQixvQkFBakI7QUFDQSxRQUFPLFNBQVAsR0FBbUIsU0FBbkI7QUFDQSxvQkFBTyxXQUFQLENBQW1CLE1BQW5CO0FBQ0EsVUFBUyxRQUFULENBQWtCLE1BQWxCO0FBQ0Q7O0FBRUQsU0FBUyxnQkFBVCxDQUEwQixnQkFBMUIsRUFBNEM7QUFDM0M7QUFDQSxLQUFJLFlBQVksd0JBQXdCLGdCQUF4QixDQUFoQjtBQUNBLEtBQUksT0FBTyxVQUFVLElBQXJCO0FBQ0EsS0FBSSxTQUFTLFVBQVUsTUFBdkI7O0FBRUEsS0FBSSxlQUFlLFNBQVMsYUFBVCxDQUF1QixJQUF2QixDQUFuQjtBQUNBLGNBQWEsU0FBYixHQUF5QixJQUF6Qjs7QUFFQSxLQUFJLG1CQUFtQixTQUFTLGFBQVQsQ0FBdUIsS0FBdkIsQ0FBdkI7QUFDQSxLQUFJLGlCQUFpQixTQUFTLGFBQVQsQ0FBdUIsS0FBdkIsQ0FBckI7QUFDQSxnQkFBZSxHQUFmLEdBQXFCLE1BQXJCO0FBQ0EsZ0JBQWUsS0FBZixDQUFxQixLQUFyQixHQUE2QixPQUE3QjtBQUNBLGdCQUFlLEtBQWYsQ0FBcUIsTUFBckIsR0FBOEIsT0FBOUI7O0FBRUEsa0JBQWlCLFdBQWpCLENBQTZCLGNBQTdCOztBQUVBLEtBQUksbUJBQW1CLFNBQVMsYUFBVCxDQUF1QixJQUF2QixDQUF2QjtBQUNBLGtCQUFpQixTQUFqQixHQUE2QixXQUFXLFVBQVUsUUFBbEQ7O0FBRUEsS0FBSSxrQkFBa0IsU0FBUyxhQUFULENBQXVCLElBQXZCLENBQXRCO0FBQ0EsaUJBQWdCLFNBQWhCLEdBQTRCLG1CQUFtQixVQUFVLE9BQXpEOztBQUVBLEtBQUksZ0JBQWdCLFNBQVMsYUFBVCxDQUF1QixJQUF2QixDQUFwQjtBQUNBLGVBQWMsU0FBZCxHQUEwQixlQUFlLFVBQVUsS0FBbkQ7O0FBRUEsS0FBSSx1QkFBdUIsU0FBUyxhQUFULENBQXVCLElBQXZCLENBQTNCO0FBQ0Esc0JBQXFCLFNBQXJCLEdBQWlDLGdCQUFnQixVQUFVLFlBQTNEOztBQUVBLDBCQUF5QixNQUF6QixDQUFnQyxZQUFoQztBQUNBLDBCQUF5QixNQUF6QixDQUFnQyxnQkFBaEM7QUFDQSwwQkFBeUIsTUFBekIsQ0FBZ0MsZ0JBQWhDO0FBQ0EsMEJBQXlCLE1BQXpCLENBQWdDLGVBQWhDO0FBQ0EsMEJBQXlCLE1BQXpCLENBQWdDLGFBQWhDO0FBQ0EsMEJBQXlCLE1BQXpCLENBQWdDLG9CQUFoQztBQUNBOztBQUVELFNBQVMsZ0JBQVQsQ0FBMEIsSUFBMUIsRUFBZ0M7QUFDL0IsU0FBUSxHQUFSLENBQVksSUFBWjtBQUNBOztBQUVELFNBQVMsZ0JBQVQsR0FBNEI7QUFDM0IsMEJBQXlCLElBQXpCLENBQThCLEVBQTlCO0FBQ0E7O0FBRUQsbUJBQU8sSUFBUCxDQUFZLGNBQVo7O0FBRUEsbUJBQU8sbUJBQVAsQ0FBMkIsWUFBTTtBQUMvQixLQUFJLFNBQVMsRUFBYjtBQUNBLFFBQU8sT0FBUCxHQUFpQixnQkFBakI7QUFDQSxvQkFBTyxXQUFQLENBQW1CLE1BQW5CO0FBQ0QsQ0FKRDs7QUFNQSxtQkFBTyxzQkFBUCxDQUE4QixVQUFDLElBQUQsRUFBVTtBQUN0QyxTQUFRLEdBQVIsQ0FBWSxJQUFaO0FBQ0Qsa0JBQWlCLEtBQUssY0FBdEI7QUFDQSwyQkFBMEIsS0FBSyx1QkFBL0I7O0FBSHVDLDRCQUs5QixDQUw4QjtBQU1sQyxjQUFZLHdCQUF3QixDQUF4QixDQU5zQjtBQU9sQyxpQkFBZSw2QkFBNkIsQ0FBN0IsR0FBaUMsR0FQZDtBQVFsQyxRQUFNLEVBQUUsWUFBRixDQVI0Qjs7QUFTdEMsTUFBSSxJQUFKLENBQVMsS0FBVCxFQUFnQixVQUFVLE1BQTFCO0FBQ0EsTUFBSSxJQUFKLENBQVMsUUFBVCxFQUFtQixPQUFuQjtBQUNBLE1BQUksSUFBSixDQUFTLE9BQVQsRUFBa0IsT0FBbEI7QUFDQSxNQUFJLEtBQUosQ0FBVSxZQUFXO0FBQ3BCLG9CQUFpQixDQUFqQjtBQUNBLEdBRkQ7QUFHQSxNQUFJLFFBQUosQ0FBYSwwQkFBYjs7QUFFSSxXQUFTLEVBQUUsVUFBRixDQWpCeUI7O0FBa0J0QyxTQUFPLElBQVAsQ0FBWSxVQUFVLElBQXRCO0FBQ0EsU0FBTyxJQUFQLENBQVksT0FBWixFQUFxQixDQUFyQjtBQUNBLGtCQUFnQixNQUFoQixDQUF1QixNQUF2QjtBQXBCc0M7O0FBS3ZDLE1BQUssSUFBSSxJQUFJLENBQWIsRUFBZ0IsSUFBSSxlQUFlLE1BQW5DLEVBQTJDLEdBQTNDLEVBQWdEO0FBQUEsTUFDM0MsU0FEMkM7QUFBQSxNQUUzQyxZQUYyQztBQUFBLE1BRzNDLEdBSDJDO0FBQUEsTUFZM0MsTUFaMkM7O0FBQUEsUUFBdkMsQ0FBdUM7QUFnQi9DO0FBRUQsQ0F2QkQ7O0FBeUJBLElBQUksdUJBQXVCLEVBQUUsNkJBQUYsQ0FBM0I7QUFDQSxxQkFBcUIsRUFBckIsQ0FBd0IsT0FBeEIsRUFBaUMsWUFBakM7O0FBRUEsSUFBSSxxQkFBcUIsRUFBRSwyQkFBRixDQUF6QjtBQUNBLG1CQUFtQixFQUFuQixDQUFzQixPQUF0QixFQUErQixVQUFTLEtBQVQsRUFBZ0I7QUFDOUMsa0JBQWlCLE1BQU0sTUFBTixDQUFhLFlBQWIsQ0FBMEIsTUFBMUIsQ0FBakI7QUFDQSxDQUZEOztBQUlBLElBQUksNkJBQTZCLEVBQUUseUJBQUYsQ0FBakM7O0FBRUEsSUFBSSwyQkFBMkIsRUFBRSwwQkFBRixDQUEvQjs7QUFFQSxJQUFJLGtCQUFrQixFQUFFLHdCQUFGLENBQXRCOzs7Ozs7OztBQzVIQSxJQUFJLGVBQUo7QUFDQSxJQUFJLHVCQUFKO0FBQ0EsSUFBSSwwQkFBSjs7QUFFQSxTQUFTLElBQVQsQ0FBYyxHQUFkLEVBQW1CO0FBQ2pCLG1CQUFpQixHQUFqQjtBQUNBLFdBQVMsSUFBSSxTQUFKLENBQWMsR0FBZCxDQUFUO0FBQ0EsVUFBUSxHQUFSLENBQVksY0FBWjtBQUNEOztBQUVELFNBQVMsT0FBVCxHQUFtQjtBQUNqQixTQUFPLE9BQU8sVUFBUCxLQUFzQixVQUFVLElBQXZDO0FBQ0Q7O0FBRUQsU0FBUyxtQkFBVCxDQUE2QixlQUE3QixFQUE4QztBQUM1QyxTQUFPLE1BQVAsR0FBZ0IsWUFBTTtBQUNwQixZQUFRLEdBQVIsQ0FBWSxNQUFaO0FBQ0E7QUFDRCxHQUhEO0FBSUQ7O0FBRUQsU0FBUyxzQkFBVCxDQUFnQyxlQUFoQyxFQUFpRDtBQUMvQyxzQkFBb0IsZUFBcEI7QUFDQSxTQUFPLFNBQVAsR0FBbUIsVUFBQyxDQUFELEVBQU87QUFDeEIsUUFBSSxPQUFPLEtBQUssS0FBTCxDQUFXLEVBQUUsSUFBYixDQUFYO0FBQ0Esb0JBQWdCLElBQWhCO0FBQ0QsR0FIRDtBQUlEOztBQUVELFNBQVMsNkJBQVQsR0FBeUM7QUFDdkMsU0FBTyxTQUFQLEdBQW1CLFVBQUMsQ0FBRCxFQUFPO0FBQ3hCLFFBQUksT0FBTyxLQUFLLEtBQUwsQ0FBVyxFQUFFLElBQWIsQ0FBWDtBQUNBLHNCQUFrQixJQUFsQjtBQUNELEdBSEQ7QUFJRDs7QUFFRCxTQUFTLFdBQVQsQ0FBcUIsT0FBckIsRUFBOEI7QUFDNUIsTUFBSSxPQUFPLFVBQVAsS0FBc0IsVUFBVSxJQUFwQyxFQUEwQztBQUN4QyxXQUFPLElBQVAsQ0FBWSxLQUFLLFNBQUwsQ0FBZSxPQUFmLENBQVo7QUFDRCxHQUZELE1BRU87QUFDTCxTQUFLLGNBQUw7QUFDQSwyQkFBdUIsaUJBQXZCO0FBQ0EsUUFBSSxPQUFPLFVBQVAsS0FBc0IsVUFBVSxJQUFwQyxFQUEwQztBQUN4QyxhQUFPLElBQVAsQ0FBWSxLQUFLLFNBQUwsQ0FBZSxPQUFmLENBQVo7QUFDRCxLQUZELE1BRU87QUFDTCxjQUFRLEdBQVIsQ0FBWSwyQkFBWjtBQUNEO0FBQ0Y7QUFDRjs7a0JBRWM7QUFDYixZQURhO0FBRWIsMENBRmE7QUFHYixnREFIYTtBQUliLDBCQUphO0FBS2IsOERBTGE7QUFNYjtBQU5hLEMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgc29ja2V0IGZyb20gJy4vd3MtY2xpZW50JztcclxuXHJcbnZhciAkID0gd2luZG93LmpRdWVyeTtcclxuXHJcbnZhciBTRVJWRVJfQUREUkVTUyA9IGxvY2F0aW9uLm9yaWdpbi5yZXBsYWNlKC9eaHR0cC8sICd3cycpO1xyXG52YXIgbXlfbmFtZSA9IEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlcm5hbWUnKSk7XHJcblxyXG52YXIgQUREX0NIQVJBQ1RFUl9CVVRUT05fU0VMRUNUT1IgPSAnW2RhdGEtbmFtZT1cImFkZF9jaGFyYWN0ZXJfYnV0dG9uXCJdJztcclxudmFyIEZJR0hURVJTX0RJU1BMQVlfU0VMRUNUT1IgPSAnW2RhdGEtbmFtZT1cImZpZ2h0ZXJzX2Rpc3BsYXlcIl0nO1xyXG52YXIgQ0hBUkFDVEVSX0RJU1BMQVlfU0VMRUNUT1IgPSAnW2RhdGEtbmFtZT1cImNoYXJhY3Rlcl9kaXNwbGF5XCJdJztcclxudmFyIEZJR0hURVJTX1NFTEVDVF9TRUxFQ1RPUiA9ICdbZGF0YS1uYW1lPVwiZmlnaHRlcnNfc2VsZWN0XCJdJztcclxudmFyIEFERF9GSUdIVEVSX0JVVFRPTl9TRUxFQ1RPUiA9ICdbZGF0YS1uYW1lPVwiYWRkX2ZpZ2h0ZXJfYnV0dG9uXCJdJztcclxuXHJcbnZhciBjaGFyYWN0ZXJfbGlzdCA9IFtdO1xyXG52YXIgY2hhcmFjdGVyX2RldGFpbGVkX2luZm8gPSBbXTtcclxuXHJcbmZ1bmN0aW9uIGFkZENoYXJhY3RlcigpIHtcclxuXHR2YXIgbmFtZV9zdHJpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5hbWVcIikudmFsdWU7XHJcblx0dmFyIGF2YXRhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXZhdGFyXCIpLnZhbHVlO1xyXG4gIGF2YXRhciA9ICcvaW1hZ2VzLycgKyBhdmF0YXI7XHJcblx0dmFyIHN0cmVuZ3RoX3N0cmluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RyZW5ndGhcIikudmFsdWU7XHJcblx0dmFyIHN0YW1pbmFfc3RyaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGFtaW5hXCIpLnZhbHVlO1xyXG5cdHZhciBzcGVlZF9zdHJpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNwZWVkXCIpLnZhbHVlO1xyXG5cdHZhciBpbnRlbGxpZ2VuY2Vfc3RyaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbnRlbGxpZ2VuY2VcIikudmFsdWU7XHJcblxyXG5cdGxldCBjaGFyYWN0ZXIgPSB7IG5hbWU6IG5hbWVfc3RyaW5nLCBhdmF0YXI6IGF2YXRhciwgc3RyZW5ndGg6IHN0cmVuZ3RoX3N0cmluZywgc3RhbWluYTogc3RhbWluYV9zdHJpbmcsIHNwZWVkOiBzcGVlZF9zdHJpbmcsIGludGVsbGlnZW5jZTogaW50ZWxsaWdlbmNlX3N0cmluZ307XHJcblxyXG4gIHZhciB0b1NlbmQgPSB7fTtcclxuICB0b1NlbmQuY29tbWFuZCA9ICdndWlsZF9zaW1fbmV3X2NoYXInO1xyXG4gIHRvU2VuZC5jaGFyYWN0ZXIgPSBjaGFyYWN0ZXI7XHJcbiAgc29ja2V0LnNlbmRNZXNzYWdlKHRvU2VuZCk7XHJcbiAgZG9jdW1lbnQubG9jYXRpb24ucmVsb2FkKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNlbGVjdF9jaGFyYWN0ZXIoY2hhcmFjdGVyX251bWJlcikge1xyXG5cdGNsZWFyX2NvbnRhaW5lcnMoKTtcclxuXHR2YXIgY2hhcmFjdGVyID0gY2hhcmFjdGVyX2RldGFpbGVkX2luZm9bY2hhcmFjdGVyX251bWJlcl07XHJcblx0bGV0IG5hbWUgPSBjaGFyYWN0ZXIubmFtZTtcclxuXHRsZXQgYXZhdGFyID0gY2hhcmFjdGVyLmF2YXRhcjtcclxuXHJcblx0dmFyIG5hbWVfZGlzcGxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcclxuXHRuYW1lX2Rpc3BsYXkuaW5uZXJIVE1MID0gbmFtZTtcclxuXHJcblx0dmFyIGF2YXRhcl9jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG5cdHZhciBhdmF0YXJfZGlzcGxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJJTUdcIik7XHJcblx0YXZhdGFyX2Rpc3BsYXkuc3JjID0gYXZhdGFyO1xyXG5cdGF2YXRhcl9kaXNwbGF5LnN0eWxlLndpZHRoID0gJzI1MHB4JztcclxuXHRhdmF0YXJfZGlzcGxheS5zdHlsZS5oZWlnaHQgPSAnMjUwcHgnO1xyXG5cclxuXHRhdmF0YXJfY29udGFpbmVyLmFwcGVuZENoaWxkKGF2YXRhcl9kaXNwbGF5KVxyXG5cclxuXHR2YXIgc3RyZW5ndGhfZGlzcGxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcclxuXHRzdHJlbmd0aF9kaXNwbGF5LmlubmVySFRNTCA9IFwiQ9C40LvQsDogXCIgKyBjaGFyYWN0ZXIuc3RyZW5ndGg7XHJcblxyXG5cdHZhciBzdGFtaW5hX2Rpc3BsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDJcIik7XHJcblx0c3RhbWluYV9kaXNwbGF5LmlubmVySFRNTCA9IFwi0KLQtdC70L7RgdC70L7QttC10L3QuNC1OiBcIiArIGNoYXJhY3Rlci5zdGFtaW5hO1xyXG5cclxuXHR2YXIgc3BlZWRfZGlzcGxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcclxuXHRzcGVlZF9kaXNwbGF5LmlubmVySFRNTCA9IFwi0KHQutC+0YDQvtGB0YLRjDogXCIgKyBjaGFyYWN0ZXIuc3BlZWQ7XHJcblxyXG5cdHZhciBpbnRlbGxpZ2VuY2VfZGlzcGxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcclxuXHRpbnRlbGxpZ2VuY2VfZGlzcGxheS5pbm5lckhUTUwgPSBcItCY0L3RgtC10LvQu9C10LrRgjogXCIgKyBjaGFyYWN0ZXIuaW50ZWxsaWdlbmNlO1xyXG5cclxuXHRjaGFyYWN0ZXJfaW5mb19jb250YWluZXIuYXBwZW5kKG5hbWVfZGlzcGxheSk7XHJcblx0Y2hhcmFjdGVyX2luZm9fY29udGFpbmVyLmFwcGVuZChhdmF0YXJfY29udGFpbmVyKTtcclxuXHRjaGFyYWN0ZXJfaW5mb19jb250YWluZXIuYXBwZW5kKHN0cmVuZ3RoX2Rpc3BsYXkpO1xyXG5cdGNoYXJhY3Rlcl9pbmZvX2NvbnRhaW5lci5hcHBlbmQoc3RhbWluYV9kaXNwbGF5KTtcclxuXHRjaGFyYWN0ZXJfaW5mb19jb250YWluZXIuYXBwZW5kKHNwZWVkX2Rpc3BsYXkpO1xyXG5cdGNoYXJhY3Rlcl9pbmZvX2NvbnRhaW5lci5hcHBlbmQoaW50ZWxsaWdlbmNlX2Rpc3BsYXkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRGaWdodGVyVG9UZWFtKHRlYW0pIHtcclxuXHRjb25zb2xlLmxvZyh0ZWFtKVxyXG59XHJcblxyXG5mdW5jdGlvbiBjbGVhcl9jb250YWluZXJzKCkge1xyXG5cdGNoYXJhY3Rlcl9pbmZvX2NvbnRhaW5lci5odG1sKFwiXCIpO1xyXG59XHJcblxyXG5zb2NrZXQuaW5pdChTRVJWRVJfQUREUkVTUyk7XHJcblxyXG5zb2NrZXQucmVnaXN0ZXJPcGVuSGFuZGxlcigoKSA9PiB7XHJcbiAgdmFyIHRvU2VuZCA9IHt9O1xyXG4gIHRvU2VuZC5jb21tYW5kID0gJ2d1aWxkX3NpbV9pbml0JztcclxuICBzb2NrZXQuc2VuZE1lc3NhZ2UodG9TZW5kKTtcclxufSk7XHJcblxyXG5zb2NrZXQucmVnaXN0ZXJNZXNzYWdlSGFuZGxlcigoZGF0YSkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKGRhdGEpO1xyXG5cdGNoYXJhY3Rlcl9saXN0ID0gZGF0YS5jaGFyYWN0ZXJfbGlzdDtcclxuXHRjaGFyYWN0ZXJfZGV0YWlsZWRfaW5mbyA9IGRhdGEuY2hhcmFjdGVyX2RldGFpbGVkX2luZm87XHJcblxyXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgY2hhcmFjdGVyX2xpc3QubGVuZ3RoOyBpKyspIHtcclxuXHRcdHZhciBjaGFyYWN0ZXIgPSBjaGFyYWN0ZXJfZGV0YWlsZWRfaW5mb1tpXVxyXG5cdFx0dmFyIHF1ZXJ5X3N0cmluZyA9ICc8aW1nPiBpZD1cImZpZ2h0ZXJfaW1hZ2VfJyArIGkgKyAnXCInXHJcblx0XHR2YXIgaW1nID0gJChxdWVyeV9zdHJpbmcpXHJcblx0XHRpbWcuYXR0cignc3JjJywgY2hhcmFjdGVyLmF2YXRhcik7XHJcblx0XHRpbWcuYXR0cignaGVpZ2h0JywgJzEwMHB4Jyk7XHJcblx0XHRpbWcuYXR0cignd2lkdGgnLCAnMTAwcHgnKTtcclxuXHRcdGltZy5jbGljayhmdW5jdGlvbigpIHtcclxuXHRcdFx0c2VsZWN0X2NoYXJhY3RlcihpKTtcclxuXHRcdH0pO1xyXG5cdFx0aW1nLmFwcGVuZFRvKGZpZ2h0ZXJzX2Rpc3BsYXlfY29udGFpbmVyKTtcclxuXHJcblx0XHR2YXIgb3B0aW9uID0gJChcIjxvcHRpb24+XCIpO1xyXG5cdFx0b3B0aW9uLmh0bWwoY2hhcmFjdGVyLm5hbWUpO1xyXG5cdFx0b3B0aW9uLmF0dHIoXCJ2YWx1ZVwiLCBpKTtcclxuXHRcdGZpZ2h0ZXJzX3NlbGVjdC5hcHBlbmQob3B0aW9uKVxyXG5cdH1cclxuXHJcbn0pO1xyXG5cclxudmFyIGFkZF9jaGFyYWN0ZXJfYnV0dG9uID0gJChBRERfQ0hBUkFDVEVSX0JVVFRPTl9TRUxFQ1RPUik7XHJcbmFkZF9jaGFyYWN0ZXJfYnV0dG9uLm9uKCdjbGljaycsIGFkZENoYXJhY3Rlcik7XHJcblxyXG52YXIgYWRkX2ZpZ2h0ZXJfYnV0dG9uID0gJChBRERfRklHSFRFUl9CVVRUT05fU0VMRUNUT1IpO1xyXG5hZGRfZmlnaHRlcl9idXR0b24ub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuXHRhZGRGaWdodGVyVG9UZWFtKGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ3RlYW0nKSk7XHJcbn0pO1xyXG5cclxudmFyIGZpZ2h0ZXJzX2Rpc3BsYXlfY29udGFpbmVyID0gJChGSUdIVEVSU19ESVNQTEFZX1NFTEVDVE9SKTtcclxuXHJcbnZhciBjaGFyYWN0ZXJfaW5mb19jb250YWluZXIgPSAkKENIQVJBQ1RFUl9ESVNQTEFZX1NFTEVDVE9SKTtcclxuXHJcbnZhciBmaWdodGVyc19zZWxlY3QgPSAkKEZJR0hURVJTX1NFTEVDVF9TRUxFQ1RPUik7XHJcbiIsImxldCBzb2NrZXQ7XHJcbmxldCBzZXJ2ZXJfYWRkcmVzcztcclxubGV0IG9uTWVzc2FnZUZ1bmN0aW9uO1xyXG5cclxuZnVuY3Rpb24gaW5pdCh1cmwpIHtcclxuICBzZXJ2ZXJfYWRkcmVzcyA9IHVybDtcclxuICBzb2NrZXQgPSBuZXcgV2ViU29ja2V0KHVybCk7XHJcbiAgY29uc29sZS5sb2coJ2Nvbm5lY3RpbmcuLicpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc1JlYWR5KCkge1xyXG4gIHJldHVybiBzb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU5cclxufVxyXG5cclxuZnVuY3Rpb24gcmVnaXN0ZXJPcGVuSGFuZGxlcihoYW5kbGVyRnVuY3Rpb24pIHtcclxuICBzb2NrZXQub25vcGVuID0gKCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ29wZW4nKTtcclxuICAgIGhhbmRsZXJGdW5jdGlvbigpO1xyXG4gIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyTWVzc2FnZUhhbmRsZXIoaGFuZGxlckZ1bmN0aW9uKSB7XHJcbiAgb25NZXNzYWdlRnVuY3Rpb24gPSBoYW5kbGVyRnVuY3Rpb247XHJcbiAgc29ja2V0Lm9ubWVzc2FnZSA9IChlKSA9PiB7XHJcbiAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UoZS5kYXRhKTtcclxuICAgIGhhbmRsZXJGdW5jdGlvbihkYXRhKTtcclxuICB9O1xyXG59XHJcblxyXG5mdW5jdGlvbiByZWdpc3Rlck1lc3NhZ2VIYW5kbGVyRGVmYXVsdCgpIHtcclxuICBzb2NrZXQub25tZXNzYWdlID0gKGUpID0+IHtcclxuICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShlLmRhdGEpO1xyXG4gICAgb25NZXNzYWdlRnVuY3Rpb24oZGF0YSk7XHJcbiAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2VuZE1lc3NhZ2UocGF5bG9hZCkge1xyXG4gIGlmIChzb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcclxuICAgIHNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaW5pdChzZXJ2ZXJfYWRkcmVzcyk7XHJcbiAgICByZWdpc3Rlck1lc3NhZ2VIYW5kbGVyKG9uTWVzc2FnZUZ1bmN0aW9uKTtcclxuICAgIGlmIChzb2NrZXQucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU4pIHtcclxuICAgICAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS5sb2coJ05vdCBzZW5kLCBidXQgcmVjb25uZWN0ZWQnKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICBpbml0LFxyXG4gIHJlZ2lzdGVyT3BlbkhhbmRsZXIsXHJcbiAgcmVnaXN0ZXJNZXNzYWdlSGFuZGxlcixcclxuICBzZW5kTWVzc2FnZSxcclxuICByZWdpc3Rlck1lc3NhZ2VIYW5kbGVyRGVmYXVsdCxcclxuICBpc1JlYWR5XHJcbn1cclxuIl19
